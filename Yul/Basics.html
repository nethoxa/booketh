<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Basics - booketh</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../EVM/index.html"><strong aria-hidden="true">1.</strong> EVM</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../EVM/Solidity Versions.html"><strong aria-hidden="true">1.1.</strong> Solidity versions</a></li><li class="chapter-item expanded "><a href="../EVM/Upgradeable.html"><strong aria-hidden="true">1.2.</strong> Upgradeable</a></li></ol></li><li class="chapter-item expanded "><a href="../Data locations/index.html"><strong aria-hidden="true">2.</strong> Data locations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Data locations/Stack.html"><strong aria-hidden="true">2.1.</strong> Stack</a></li><li class="chapter-item expanded "><a href="../Data locations/Memory.html"><strong aria-hidden="true">2.2.</strong> Memory</a></li><li class="chapter-item expanded "><a href="../Data locations/Storage.html"><strong aria-hidden="true">2.3.</strong> Storage</a></li><li class="chapter-item expanded "><a href="../Data locations/Calldata.html"><strong aria-hidden="true">2.4.</strong> Calldata</a></li></ol></li><li class="chapter-item expanded "><a href="../Tokens/index.html"><strong aria-hidden="true">3.</strong> Tokens</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Tokens/ERC 20.html"><strong aria-hidden="true">3.1.</strong> ERC 20</a></li><li class="chapter-item expanded "><a href="../Tokens/ERC 721.html"><strong aria-hidden="true">3.2.</strong> ERC 721</a></li><li class="chapter-item expanded "><a href="../Tokens/ERC 777.html"><strong aria-hidden="true">3.3.</strong> ERC 777</a></li><li class="chapter-item expanded "><a href="../Tokens/ERC 1155.html"><strong aria-hidden="true">3.4.</strong> ERC 1155</a></li><li class="chapter-item expanded "><a href="../Tokens/ERC 4626.html"><strong aria-hidden="true">3.5.</strong> ERC 4626</a></li></ol></li><li class="chapter-item expanded "><a href="../DeFi/index.html"><strong aria-hidden="true">4.</strong> DeFi</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../DeFi/Uniswap.html"><strong aria-hidden="true">4.1.</strong> Uniswap</a></li><li class="chapter-item expanded "><a href="../DeFi/AAVE.html"><strong aria-hidden="true">4.2.</strong> AAVE</a></li><li class="chapter-item expanded "><a href="../DeFi/Curve.html"><strong aria-hidden="true">4.3.</strong> Curve</a></li></ol></li><li class="chapter-item expanded "><a href="../Yul/index.html"><strong aria-hidden="true">5.</strong> Yul</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Yul/Basics.html" class="active"><strong aria-hidden="true">5.1.</strong> Basics</a></li><li class="chapter-item expanded "><a href="../Yul/Advanced.html"><strong aria-hidden="true">5.2.</strong> Advanced</a></li><li class="chapter-item expanded "><a href="../Yul/ERC 20.html"><strong aria-hidden="true">5.3.</strong> ERC 20</a></li><li class="chapter-item expanded "><a href="../Yul/Functions.html"><strong aria-hidden="true">5.4.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../Yul/Opcodes.html"><strong aria-hidden="true">5.5.</strong> Opcodes</a></li></ol></li><li class="chapter-item expanded "><a href="../References.html"><strong aria-hidden="true">6.</strong> References</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">booketh</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="basics"><a class="header" href="#basics">Basics</a></h1>
<p>FUCKING READ <a href="https://github.com/andreitoma8/learn-yul">THIS</a> AS MANY TIMES AS POSSIBLE  -&gt; DRY</p>
<h2 id="index"><a class="header" href="#index">Index</a></h2>
<ul>
<li><a href="#variables">Variables</a></li>
<li><a href="#execution-flow">Execution flow</a></li>
<li><a href="#outside-variables-in-assemly">Outside variables in assembly</a></li>
<li><a href="#memory-pointer">Memory pointer</a></li>
<li><a href="#storage-slots">Storage slots</a></li>
<li><a href="#syntax">Syntax</a></li>
</ul>
<h2 id="variables"><a class="header" href="#variables">Variables</a></h2>
<p>You can initialise strings with <code>&quot;askjdajsgdaghsdg&quot;</code> up to 32 characters. For variables, we have:</p>
<ul>
<li><code>let VAR := VALUE</code></li>
<li><code>let VAR := EXPRESSION</code></li>
<li><code>let VAR</code> -&gt; defaults to zero</li>
</ul>
<h2 id="execution-flow"><a class="header" href="#execution-flow">Execution flow</a></h2>
<p>The <code>leave</code> statement can be used to exit the current function. It works like the <code>return</code> statement in other languages just that it does not take a value to return, it just exits the functions and the function will return whatever values are currently assigned to the return variable(s).</p>
<p>Note that the EVM dialect has a built-in function called <code>return</code> that quits the full execution context (internal message call) and not just the current yul function.</p>
<p>The following example implements the power function by square-and-multiply.</p>
<pre><code class="language-solidity">{
    function power(base, exponent) -&gt; result {
        switch exponent
        case 0 { result := 1 } // something^0 is 1
        case 1 { result := base } // something^1 is something
        default {
            result := power(mul(base, base), div(exponent, 2)) // recursive call with sqrt(exponent)
            switch mod(exponent, 2)
                case 1 { result := mul(base, result) } // last step
        }
    }
}
</code></pre>
<h2 id="outside-variables-in-assemly"><a class="header" href="#outside-variables-in-assemly">Outside variables in assemly</a></h2>
<p>When we access a type which is less than 32 bytes, it's better to clean the variable BEFORE using them, because there is no mechanism in Solidity that cleans those high bytes</p>
<pre><code class="language-solidity">assembly {
    x := and(x, 0xffffffff)
}
</code></pre>
<h2 id="memory-pointer"><a class="header" href="#memory-pointer">Memory pointer</a></h2>
<p>For memory access, there is a pointer in <code>0x40</code> which points initialy to <code>0x80</code> as the first direction avaiable to use. There is no <code>free</code>, so anything that is written to <code>storage</code> remains there</p>
<p>In assembly, it seems that there is no arithmetic checks, so if you want them you shall write</p>
<pre><code class="language-solidity">assembly(&quot;memory-safe&quot;) {
    ...
}
</code></pre>
<p>If you annotate an assembly block as memory-safe, but violate one of the memory assumptions, this will lead to incorrect and undefined behaviour that cannot easily be discovered by testing. Here is an example from the official documentation that calculates powers:</p>
<pre><code class="language-solidity">assembly {
    result := 1
    // int i = 0        i &lt; exponent        i++
    for { let i := 0 } lt(i, exponent) { i := add(i, 1) }
    {
        // result *= base
        result := mul(result, base)
    }
}
</code></pre>
<h2 id="storage-slots"><a class="header" href="#storage-slots">Storage slots</a></h2>
<p>To get the storage slot of a variable, use <code>VAR.slot</code> which is the POINTER TO SOMEWHERE, NOT THE VALUE THERE. To read/write to it, do <code>sload(VAR.slot)</code> or <code>sstore(VAR.slot, VAR_EXTERNAL)</code>. Next is an example of multiple variables being packed into one slot (from <a href="https://github.com/andreitoma8/learn-yul">here</a>):</p>
<pre><code class="language-solidity">uint128 a;
uint96 b;
uint16 c;
uint8 d;

function set(uint16 _c) public {
    assembly{
        // Get the storage slot of the variable
        let wholeSlot := sload(c.slot)

        // Clear the variable's bits in the slot. Since it is a uint16, it is 2 bytes long.
        let cleared := and(wholeSlot, 0xffff0000ffffffffffffffffffffffffffffffffffffffffffffffffffffffff)

        // Shift the new value to the left by the offset of the variable multiplied by 8(1 byte = 8 bits)
        let shifted := shl(mul(c.offset, 8), _c)

        // Combine the cleared slot and the shifted value
        let newValue := or(shifted, cleared)

        // Store the new value in the slot
        sstore(c.slot, newValue)
    }
}

function get() public view returns (uint16 c_) {
    assembly {
        // Get the storage slot of the variable
        let wholeSlot := sload(c.slot)

        // Shift the slot to the right by the offset of the variable
        let shifted := shr(mul(c.offset, 8), wholeSlot)

        // Mask the slot to get the value of the variable
        c_ := and(shifted, 0xffff)
    }
}
</code></pre>
<p>To get the bytes32 value at a specific index of a fixed array:</p>
<pre><code class="language-solidity">uint256[5] arr;

function get(uint256 index) public view returns (uint256 value) {
    assembly {
        value := sload(add(arr.slot, index))
    }
}
</code></pre>
<p>To get the bytes32 value at a specific index of a dynamic array:</p>
<pre><code class="language-solidity">uint256[] arr;

function get(uint256 index) public view returns (uint256 value) {
    uint256 slot;
    assembly {
        slot := arr.slot
    }
    bytes32 location = keccak256(abi.encode(slot));

    assembly{
        value := sload(add(location, index))
    }
}
</code></pre>
<p>Mappings behave similar to arrays, but it concatenates the key and the mapping's storage slot to get the location of the value:</p>
<pre><code class="language-solidity">mapping(uint256 =&gt; uint256) map;

function get(uint256 key) public view returns (uint256 value) {
    bytes32 slot;
    assembly {
        slot := map.slot
    }
    bytes32 location = keccak256(abi.encode(key, uint256(slot)));

    assembly{
        value := sload(location)
    }
}
</code></pre>
<p>Nested mappings are similar, but use hashes of hashes to get the location of the value. The concatenation and the hashing is done from right to left:</p>
<pre><code class="language-solidity">mapping(uint256 =&gt; mapping(uint256 =&gt; uint256)) map;

function get(uint256 key1, uint256 key2) public view returns (uint256 value) {
    bytes32 slot;
    assembly {
        slot := map.slot
    }
    bytes32 location = keccak256(abi.encode(key2, keccak256(abi.encode(key1, uint256(slot)))));

    assembly{
        value := sload(location)
    }
}
</code></pre>
<p>For mappings of arrays:</p>
<pre><code class="language-solidity">mapping(address =&gt; uint256[]) map;

function get(address key, uint256 index) public view returns (uint256 value) {
    bytes32 slot;
    assembly {
        slot := map.slot
    }
    bytes32 location = keccak256(abi.encode(keccak256(abi.encode(key, uint256(slot)))));

    assembly{
        value := sload(add(location, index))
    }
}
</code></pre>
<h2 id="syntax"><a class="header" href="#syntax">Syntax</a></h2>
<pre><code class="language-solidity">if lt(A, B) {...} // lt may be something else
</code></pre>
<pre><code class="language-solidity">switch A
case AA {
    ...
}
case B {
    ...
}
default {
    ...
}
</code></pre>
<pre><code class="language-solidity">for { let i := 0 } lt(i, 0x100) { i := add(i, 0x20) } {
    ...
}
</code></pre>
<pre><code class="language-solidity">// the same as above but in a while like style
for { } lt(i, 0x100) { } {     // while(i &lt; 0x100)
        i := add(i, 0x20)
    }
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Yul/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../Yul/Advanced.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Yul/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../Yul/Advanced.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
